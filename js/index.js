const thirdPreviousDataSet = [
  {
    YR: 2015,
    MUNICIPALITY: "Bucks County",
    PROJECTNAME: "Cross Keys Planning and Transportation Study",
    ID: 361,
    AMOUNT: 80000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Bensalem Township",
    PROJECTNAME: "Bensalem Riverfont Master Plan Evaluation",
    ID: 362,
    AMOUNT: 100000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "New Britain Borough",
    PROJECTNAME: "Main Street in Britain",
    ID: 363,
    AMOUNT: 80000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Caln Township",
    PROJECTNAME: "Route 30 Multi Modal Transportation Plan",
    ID: 364,
    AMOUNT: 75000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Coatesville",
    PROJECTNAME: "Downtown Parking Study",
    ID: 365,
    AMOUNT: 20000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Phoenixville",
    PROJECTNAME: "SALDO Update",
    ID: 366,
    AMOUNT: 20000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Schuylkill Township",
    PROJECTNAME: "Schuylkill Sidwalk System",
    ID: 367,
    AMOUNT: 60000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Aston Township",
    PROJECTNAME: "Comprehensive Plan Update",
    ID: 368,
    AMOUNT: 88000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Clifton Heights",
    PROJECTNAME: "Clifton Heights Market Study",
    ID: 369,
    AMOUNT: 20000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Delaware County Planning Dept.",
    PROJECTNAME: "Technical Asssistance for Energy Efficiency",
    ID: 381,
    AMOUNT: 76000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Media Borough",
    PROJECTNAME: "Wayfinding Signage",
    ID: 382,
    AMOUNT: 40000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Abington Township",
    PROJECTNAME: "Master Bicycle Plan",
    ID: 383,
    AMOUNT: 60000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Lower Moreland",
    PROJECTNAME: "Historic Bethayres Streetscape Plan",
    ID: 401,
    AMOUNT: 20000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Montgomery County",
    PROJECTNAME: "Walkability Plan",
    ID: 402,
    AMOUNT: 50000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Upper Merion",
    PROJECTNAME: "First Avenue Linear Park",
    ID: 403,
    AMOUNT: 88000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Whitemarsh",
    PROJECTNAME: "Riverfront Plan",
    ID: 404,
    AMOUNT: 48000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Philadelphia",
    PROJECTNAME: "Complete Streets Improvements",
    ID: 405,
    AMOUNT: 100000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Philadelphia",
    PROJECTNAME: "University City Access",
    ID: 406,
    AMOUNT: 75000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Philadelphia",
    PROJECTNAME: "Rails and Trails",
    ID: 407,
    AMOUNT: 100000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "New Hanover Twp",
    PROJECTNAME: "Wrightstown Cookstown Redevelopment Plan",
    ID: 408,
    AMOUNT: 50000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Bordentown City",
    PROJECTNAME: "Ocean Spray Redevelopment",
    ID: 409,
    AMOUNT: 100000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Burlington County",
    PROJECTNAME: "Rancocas Creek Greenway",
    ID: 410,
    AMOUNT: 95000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Pemberton",
    PROJECTNAME: "Complete Streets Policy",
    ID: 411,
    AMOUNT: 50000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Audubon",
    PROJECTNAME: "East Atlantic Avenue Corridor",
    ID: 412,
    AMOUNT: 60000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Camden City",
    PROJECTNAME: "Downtown Corridors Traffic Feasibility",
    ID: 413,
    AMOUNT: 60000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Gloucester Township",
    PROJECTNAME: "Blackhorse PikeRedevelopment Plan",
    ID: 414,
    AMOUNT: 64000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Merchantville Borough",
    PROJECTNAME: "Town Centre Redevelopment",
    ID: 415,
    AMOUNT: 35000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Woodbury",
    PROJECTNAME: "Transportation Hub Study",
    ID: 416,
    AMOUNT: 75000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Trenton",
    PROJECTNAME: "Trenton250-Downtown Parking Plan",
    ID: 417,
    AMOUNT: 100000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Gloucester County",
    PROJECTNAME: "GC2040: Unified Land Use and Transportation Element",
    ID: 421,
    AMOUNT: 125000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Monroe Township",
    PROJECTNAME: "Multi Modal Transportation System Plan",
    ID: 441,
    AMOUNT: 85000,
  },
  {
    YR: 2015,
    MUNICIPALITY: "Woolwich Township",
    PROJECTNAME: "Unified Land Use and Transportation Master Plan",
    ID: 461,
    AMOUNT: 100000,
  },
];
const secondPreviousDataSet = [
  {
    YR: 2017,
    MUNICIPALITY: "Bucks County Planning Department",
    PROJECTNAME: "Bristol Township Economic Development Analysis",
    ID: 481,
    AMOUNT: 80000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Chester County Planning Department",
    PROJECTNAME: "Phoenixville Region Multi Modal Transportation Plan",
    ID: 482,
    AMOUNT: 52000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Chester County Planning Department",
    PROJECTNAME: "Brandywine Valley Wayfinding Signage Plan",
    ID: 483,
    AMOUNT: 40000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "East Goshen Township",
    PROJECTNAME: "Paoli Pike Corridor Master Plan",
    ID: 484,
    AMOUNT: 52500,
  },
  {
    YR: 2017,
    MUNICIPALITY: "East Whiteland Township",
    PROJECTNAME: "Route 30 Corridor Study",
    ID: 485,
    AMOUNT: 75000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Phoenixville",
    PROJECTNAME: "Downtown Parking Study",
    ID: 486,
    AMOUNT: 34000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "West Whiteland Township",
    PROJECTNAME: "Pottstown Pike Congestion Mitigation Feasibility Study",
    ID: 487,
    AMOUNT: 25000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Delaware County Planning Department",
    PROJECTNAME: "Downtown Awakening",
    ID: 488,
    AMOUNT: 80000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Media Borough",
    PROJECTNAME: "Updated Economic Development Strategy",
    ID: 489,
    AMOUNT: 56250,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Morton Borough",
    PROJECTNAME: "Morton Connect",
    ID: 490,
    AMOUNT: 36000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Upper Darby Township",
    PROJECTNAME: "Mutli-Modal Modernization of the Garrett Road Corridor",
    ID: 491,
    AMOUNT: 71250,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Abington Township",
    PROJECTNAME: "Walk Park Train",
    ID: 492,
    AMOUNT: 75000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Lansdale Borough",
    PROJECTNAME: "Liberty Bell Trail Alignment Study",
    ID: 493,
    AMOUNT: 28000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Lower Providence",
    PROJECTNAME: "Ridge Pike West Corridor Study",
    ID: 494,
    AMOUNT: 80000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Montgomery County Planning Commission",
    PROJECTNAME: "Bike Montco Plan Development",
    ID: 495,
    AMOUNT: 30000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Upper Dublin Township",
    PROJECTNAME: "Transportation Demand Plan for FWOP",
    ID: 496,
    AMOUNT: 75000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Philadelphia City Planning Commission",
    PROJECTNAME: "Wissahickon Gateway",
    ID: 497,
    AMOUNT: 100000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Office of Transportation & Infrastructure Systems",
    PROJECTNAME: "Where the Sidewalk Gaps",
    ID: 498,
    AMOUNT: 100000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Office of Transportation and Infrastructure Systems",
    PROJECTNAME: "Complete Streets Calculator",
    ID: 499,
    AMOUNT: 80000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Department of Streets, City of Philadelphia",
    PROJECTNAME: "Critical Matchmaking between Vision Zero Research",
    ID: 500,
    AMOUNT: 30000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Burlington County Planning",
    PROJECTNAME: "River Route Circulation",
    ID: 501,
    AMOUNT: 175000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Burlington County",
    PROJECTNAME: "Bridgeboro Redesign (Route 130 Intersecton)",
    ID: 502,
    AMOUNT: 100000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Cherry Hill",
    PROJECTNAME: "Woodcrest Station (TOD) Plan",
    ID: 503,
    AMOUNT: 60000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Camden County",
    PROJECTNAME: "Walter Rand Market Feasbility",
    ID: 504,
    AMOUNT: 100000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Princeton",
    PROJECTNAME: "Princeton Parking",
    ID: 505,
    AMOUNT: 65000,
  },
  {
    YR: 2017,
    MUNICIPALITY: "Trenton",
    PROJECTNAME: "Waterfront Reclamation",
    ID: 506,
    AMOUNT: 100000,
  },
];
// NOTE: the ID's here aare completely arbitrary. The provided file had every "ID": 0 for every entry so I made up a 600+ range for the hover effect to work This applies for currentDataSet too
//const previousDataSet =  [{"YR": 2019, "MUNICIPALITY":"Concord Township","PROJECTNAME":"US 1/US 202 Corridor Pedestrian Improvement Plan","ID":600,"AMOUNT":72000,"PROJ_DESC":"Analyze and create conceptual designs  for multi-modal improvements along the corridors."},{"MUNICIPALITY":"Montgomery County","PROJECTNAME":"Creating Equitable Connections to the Montgomery County Trail System","ID":601,"AMOUNT":75000,"PROJ_DESC":"Create a plan that increases the diversity of users to the county trail system, accessibility,  and provides for a modernized design for all users."},{"MUNICIPALITY":"Multi-Municipal - Collingswood Borough & Haddon Township","PROJECTNAME":"Bicycle and Pedestrian Enhancements Master Plan","ID":602,"AMOUNT":72000,"PROJ_DESC":"Develop a bicycle and pedestrian network that seamlessly links the two communities, focusing on travel to, from, and along Haddon Avenue that will encourage greater usage of bicycles and walking."},{"MUNICIPALITY":"Burlington City","PROJECTNAME":"Downtown Circulation Plan","ID":603,"AMOUNT":50000,"PROJ_DESC":"Update the master plan element to increase  economic opportunities and capitalize on the two light rail stations and proposed residential development with in the City."},{"MUNICIPALITY":"Multi-Municipal - Burlington City, Burlington Township, Mount Holly Township & Westampton Township","PROJECTNAME":"County Route 541 Corridor Study","ID":604,"AMOUNT":150000,"PROJ_DESC":"Prepare a coordinated transportation and circulation plan  for the CR 541 corridor that includes Burlington City, Burlington Township, Westampton Township and Mount Holly Township. "},{"MUNICIPALITY":"Chalfont Borough","PROJECTNAME":"Parking Consolidation and Streetscape Plan","ID":605,"AMOUNT":50000,"PROJ_DESC":"Create a schematic layout for consolidated parking and streetscape plan to encourage revitalization in the downtown."},{"MUNICIPALITY":"Philadelphia","PROJECTNAME":"Central Philadelphia Transportation Analysis Program","ID":606,"AMOUNT":100000,"PROJ_DESC":"Work with key partners to define investment needs for data collection and analysis to inform the City and its partners about steps needed in collecting meaningful data to shape strategic policy and funding decisions that will improve mobility."},{"MUNICIPALITY":"New Garden Township","PROJECTNAME":"Transportation Improvement Plan for the Village of Toughkenamon","ID":607,"AMOUNT":65000,"PROJ_DESC":"Create a transportation plan to reenergize the village with a variety of local commercial establishments,, a diversity of housing options for all ages, with attractive open spaces and streetscapes."},{"MUNICIPALITY":"Camden City","PROJECTNAME":"Connecting Transportation and Land Use Along Haddon Avenue","ID":608,"AMOUNT":100000,"PROJ_DESC":"Improve bike and pedestrian connections with a zoning land use overlay to accommodate freight and home based deliveries to be used to enhance existing and future redevelopment plans along the Medical Mile in Camden City."},{"MUNICIPALITY":"Lawrence Township","PROJECTNAME":"Brunswick Pike Streetscape","ID":609,"AMOUNT":60000,"PROJ_DESC":"Prepare conceptual streetscape plans that enhance pedestrian access and facilitate community meetings to garner support for the revitalization of Brunswick Pike ."},{"MUNICIPALITY":"Chester County","PROJECTNAME":"Active Transportation Municipal Ordinance Inventory and Outreach","ID":610,"AMOUNT":125000,"PROJ_DESC":"Review and identify potential ordinance amendments to increase active transportation throughout the County."},{"MUNICIPALITY":"Merchantville Borough","PROJECTNAME":"Lighting Feasibility Study","ID":611,"AMOUNT":33000,"PROJ_DESC":"Explore the various solar and electric options, types of feasible pedestrian-oriented light fixtures, and design solutions for the various segments of a multi-municipal path."},{"MUNICIPALITY":"Philadelphia","PROJECTNAME":"Vision Zero Pedestrian Safety Study and Action Plan","ID":612,"AMOUNT":100000,"PROJ_DESC":"Continue efforts to identify causes pedestrian crashes, develop priority pedestrian HIN corridors and “pedestrian focus areas, ” and recommend systemic engineering improvements."},{"MUNICIPALITY":"Middletown Township","PROJECTNAME":"Comprehensive Plan Development","ID":613,"AMOUNT":67000,"PROJ_DESC":"Develop a sustainable comprehensive plan that addresses the changing demographics and development pattern of the Township."},{"MUNICIPALITY":"Philadelphia","PROJECTNAME":"North Philadelphia Station Area","ID":614,"AMOUNT":100000,"PROJ_DESC":"Develop a transportation plan that improves the safety, usability, and appearance of the station, connects to the street grid, and encourages better stormwater management practices."},{"MUNICIPALITY":"Multi-Municipal - Hatboro Borough & Upper Moreland Township","PROJECTNAME":"Master Trail Feasibility Plan","ID":615,"AMOUNT":72000,"PROJ_DESC":"Develop a Master Trail Plan to close gaps in existing regional trails, provide transportation alternatives to residents, identify trail spurs to local neighborhoods, and contribute to the economic growth of local businesses."},{"MUNICIPALITY":"Philadelphia","PROJECTNAME":"Complete Streets","ID":616,"AMOUNT":100000,"PROJ_DESC":"Develop conceptual renderings of 3 identified dangerous intersections to enhance the overall communities’ appearance and promote walking and biking."},{"MUNICIPALITY":"Lower Merion Township","PROJECTNAME":"Multi-Modal Strategies and Policies","ID":617,"AMOUNT":52000,"PROJ_DESC":"Review TDM policies as part of ongoing planning efforts to modernize  regulatory and planning documents to address residential transportation impacts."},{"MUNICIPALITY":"Cheltenham Township","PROJECTNAME":"Transportation Impact Study","ID":618,"AMOUNT":100000,"PROJ_DESC":"Develop and adopt a Transportation Impact Fee Ordinance to address impacts from new residential development."},{"MUNICIPALITY":"Gloucester City","PROJECTNAME":"Port Neighborhood Transportation Study","ID":619,"AMOUNT":65000,"PROJ_DESC":"Analyze traffic patterns in the port area and its impact on adjacent residential neighborhoods."},{"MUNICIPALITY":"Pottstown Borough","PROJECTNAME":"Keim Street Gateway Overlay Planning","ID":620,"AMOUNT":32000,"PROJ_DESC":"Create an overlay to increase access to the Schuylkill River Trail, improve the quality of life for the adjacent residential neighborhoods, and enhance the economic performance of the Industrial Center."},{"MUNICIPALITY":"Media Borough","PROJECTNAME":"Traffic Calming Study","ID":621,"AMOUNT":90000,"PROJ_DESC":"Enhance pedestrian and bicycle safety along high speed vehicular routes outside the downtown."},{"MUNICIPALITY":"Multi-Municipal - Mount Laurel Township, Westampton Township & Willingboro Township","PROJECTNAME":"Centerton Road Pedestrian-Bicycle Bridge Feasibility Study","ID":622,"AMOUNT":70000,"PROJ_DESC":"Determine the feasibility of constructing a pedestrian bridge to re-connect the Townships of Willingboro, Westampton, and Mt. Laurel, to provide access to recreational  amenities along the Rancocas Creek."}]
const previousDataSet = [
  {
    YR: "2019",
    ID: "521",
    COUNTY: "Chester County ",
    MUNICIPALITY: "Chester County",
    AMOUNT: "125000",
    PROJECTNAME:
      "Active Transportation Municipal Ordinance Inventory and Outreach",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "524",
    COUNTY: "Burlington ",
    MUNICIPALITY: "Burlington City",
    AMOUNT: "50000",
    PROJECTNAME: "Downtown Circulation Plan",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "527",
    COUNTY: "Philadelphia",
    MUNICIPALITY: "City of Philadelphia (PCPC)",
    AMOUNT: "100000",
    PROJECTNAME: "Complete Streets",
    PM: "bmastaglio",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "528",
    COUNTY: "Philadelphia",
    MUNICIPALITY: "City of Philadelphia (oTis)",
    AMOUNT: "100000",
    PROJECTNAME: "Central Philadelphia Transportation Analysis Program",
    PM: "abernknopf",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "529",
    COUNTY: "Burlington",
    MUNICIPALITY: "Burlington County Bridge Commission",
    AMOUNT: "150000",
    PROJECTNAME: "County Route 541 Corridor Study",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "530",
    COUNTY: "Camden",
    MUNICIPALITY: "Gloucester City",
    AMOUNT: "65000",
    PROJECTNAME: "Port Neighborhood Transportation Study",
    PM: "mruane",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "531",
    COUNTY: "Camden ",
    MUNICIPALITY: "Collingswood Borough",
    AMOUNT: "72000",
    PROJECTNAME: "Bicycle and Pedestrian Enhancements Master Plan",
    PM: "tstead",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "532",
    COUNTY: "Montgomery",
    MUNICIPALITY: "Montgomery County",
    AMOUNT: "75000",
    PROJECTNAME:
      "Creating Equitable Connections to the Montgomery County Trail System",
    PM: "clinn",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "533",
    COUNTY: "Montgomery County",
    MUNICIPALITY: "Cheltenham Township",
    AMOUNT: "100000",
    PROJECTNAME: "Transportation Impact Study",
    PM: "asvekla",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "537",
    COUNTY: "Mercer County",
    MUNICIPALITY: "Lawrence Township",
    AMOUNT: "60000",
    PROJECTNAME: "Brunswick Pike Streetscape",
    PM: "laxelson",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "538",
    COUNTY: "Philadelphia",
    MUNICIPALITY: "City of Philadelphia (PCPC)",
    AMOUNT: "100000",
    PROJECTNAME: "North Philadelphia Station Area",
    PM: "kmorris",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "540",
    COUNTY: "Montgomery County, PA",
    MUNICIPALITY: "Pottstown Borough",
    AMOUNT: "32000",
    PROJECTNAME: "Keim Street Gateway Overlay Planning",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "541",
    COUNTY: "Bucks",
    MUNICIPALITY: "Middletown Township",
    AMOUNT: "67000",
    PROJECTNAME: "Comprehensive Plan Update",
    PM: "dlombardi",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "542",
    COUNTY: "Chester ",
    MUNICIPALITY: "New Garden Township",
    AMOUNT: "65000",
    PROJECTNAME:
      "Transportation Improvement Plan for the Village of Toughkenamon",
    PM: "abeatty",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "544",
    COUNTY: "Bucks ",
    MUNICIPALITY: "Chalfont Borough",
    AMOUNT: "50000",
    PROJECTNAME: "Parking Consolidation & Streetscape Plan",
    PM: "cboulan",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "545",
    COUNTY: "Montgomery ",
    MUNICIPALITY: "Upper Moreland Township",
    AMOUNT: "72000",
    PROJECTNAME: "Master Trail Plan",
    PM: "mandrews",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "547",
    COUNTY: "Pennsylvania",
    MUNICIPALITY: "City of Philadelphia (oTis)",
    AMOUNT: "100000",
    PROJECTNAME: "Vision Zero Pedestrian Safety Study & Action Plan",
    PM: "kmurphy",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "549",
    COUNTY: "Burlington County",
    MUNICIPALITY: "Burlington County",
    AMOUNT: "70000",
    PROJECTNAME: "Centerton Road Pedestrian-Bicycle Bridge Feasibility Study",
    PM: "slegendre",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "551",
    COUNTY: "Camden County",
    MUNICIPALITY: "Merchantville Borough",
    AMOUNT: "33000",
    PROJECTNAME: "Lighting Feasibility Study",
    PM: "ecompitello",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "552",
    COUNTY: "Delaware ",
    MUNICIPALITY: "Media Borough",
    AMOUNT: "90000",
    PROJECTNAME: "Traffic Calming Study",
    PM: "gkrykewycz",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "553",
    COUNTY: "Camden ",
    MUNICIPALITY: "Camden County",
    AMOUNT: "100000",
    PROJECTNAME: "Connecting Transportation and Land Use Along Haddon Avenue",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "556",
    COUNTY: "Montgomery County",
    MUNICIPALITY: "Lower Merion Township",
    AMOUNT: "52000",
    PROJECTNAME: "Multi-Modal Strategies and Policies",
    PM: "pelkis",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "559",
    COUNTY: "Delaware County",
    MUNICIPALITY: "Concord Township",
    AMOUNT: "72000",
    PROJECTNAME: "1/202 Corridor Pedestrian Improvement Plan",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
];

const currentDataSet = {
  type: "FeatureCollection",
  name: "TCDI",
  crs: { type: "name", properties: { name: "urn:ogc:def:crs:OGC:1.3:CRS84" } },
  features: [
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Bucks County",
        co_name: "Bucks",
        state: "PA",
        PROJECTNAME: "Bucks County Pedestrian Safety Enhancements",
        projectnum: 0,
        projecttyp: null,
        ID: 700,
        status: null,
        AMOUNT: 80000,
        PROJ_DESC:
          "This study will provide pedestrian enhancements at five locations throughout Bucks County with a high rate of pedestrian fatalities and vehicular conflicts: Route 13/Levittown Parkway, Street Road Corridor, Knights Road to Hulmeville Road,",
        proj_desc2:
          "Newtown Road to York Road, and Buck Road to Pennsylvania Boulevard.",
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$80,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the county level",
        geography: "County",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.106422616839239, 40.336813359910749],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Bucks County Planning Commission",
        co_name: "Bucks",
        state: "PA",
        PROJECTNAME: "Upper Bucks County Area Public Transportation Analysis",
        projectnum: 0,
        projecttyp: null,
        ID: 701,
        status: null,
        AMOUNT: 60000,
        PROJ_DESC:
          "Based upon municipal interest and a public opinion survey, this study will analyze the concept of providing public transportation in this area that has traditionally had a lack of viable public transportation options.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$60,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-74.957479739394088, 40.361697175786396],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Kennett Square Borough",
        co_name: "Chester",
        state: "PA",
        PROJECTNAME: "Kennett Region Micro-Transit Feasibility",
        projectnum: 0,
        projecttyp: null,
        ID: 702,
        status: null,
        AMOUNT: 80000,
        PROJ_DESC:
          "This rural area does not have public transportation options that support the current demand. This study will assess the feasibility of an expanded and coordinated network of micro-transit services.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$80,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.711259871828645, 39.843830953625371],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Charlestown Township",
        co_name: "Chester",
        state: "PA",
        PROJECTNAME: "Devault Trail Activation Feasibility",
        projectnum: 0,
        projecttyp: null,
        ID: 703,
        status: null,
        AMOUNT: 64000,
        PROJ_DESC:
          "This plan will examine the feasibility of using a six-mile, dormant freight-rail line to create a pedestrian/bicycle connection between the Borough of Phoenixville and the office parks and corporate employment centers of Great Valley.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$64,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.558710456141, 40.085128861552704],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Eddystone Borough",
        co_name: "Delaware",
        state: "PA",
        PROJECTNAME: "Route 291 Corridor Improvements",
        projectnum: 0,
        projecttyp: null,
        ID: 704,
        status: null,
        AMOUNT: 48000,
        PROJ_DESC:
          "Recognizing the need for safety and corridor improvements for an anticipated warehousing and industrial space, this study will evaluate current traffic conditions and provide rail, bus, and vehicular connections as well as zoning and land development",
        proj_desc2: "ordinance revisions to ensure minimal community impact.",
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$48,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.333519128017713, 39.85575540532934],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Media Borough",
        co_name: "Delaware",
        state: "PA",
        PROJECTNAME: "Hybrid Form-Based Code",
        projectnum: 0,
        projecttyp: null,
        ID: 705,
        status: null,
        AMOUNT: 64000,
        PROJ_DESC:
          "TCDI funds will be used to create a hybrid Form-Based Code that focuses on all future residential projects—both building and street design—in the borough.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$64,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.388976091335905, 39.919755173788388],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Lansdowne Borough",
        co_name: "Delaware",
        state: "PA",
        PROJECTNAME: "Eastern Delco Bikeway Prioritization",
        projectnum: 0,
        projecttyp: null,
        ID: 706,
        status: null,
        AMOUNT: 85000,
        PROJ_DESC:
          "The communities of Lansdowne, East Lansdowne, Yeadon, and Upper Darby will conduct a feasibility study that builds on the work of DVRPC’s Bicycle Level of Traffic Stress study to define a regional bicycle network with implementation priorities and",
        proj_desc2: "bicycle ridership strategies.",
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$85,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.276036530084212, 39.940772195218962],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Upper Gwynedd Township",
        co_name: "Montgomery",
        state: "PA",
        PROJECTNAME: "Advancing the Liberty Bell Trail",
        projectnum: 0,
        projecttyp: null,
        ID: 707,
        status: null,
        AMOUNT: 113000,
        PROJ_DESC:
          "To enhance trail accessibility in the North Penn region, Upper Gwynedd Township will collaborate with seven nearby municipalities—North Wales Borough, Lansdale Borough, Hatfield Township, Hatfield Borough, Franconia Township, Souderton Borough and",
        proj_desc2:
          "Telford Borough to complete a feasibility study that will update a current trail plan for an 11-mile section of the Liberty Bell Trail corridor.",
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$113,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.308856447725134, 40.218367530977282],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Montgomery County",
        co_name: "Montgomery",
        state: "PA",
        PROJECTNAME: "Cross County Trail Feasibility",
        projectnum: 0,
        projecttyp: null,
        ID: 708,
        status: null,
        AMOUNT: 90000,
        PROJ_DESC:
          "TCDI funds will be used to plan for gaps in the county trail network with a focus on a missing  6-mile long stretch in eastern Montgomery County.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$90,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the county level",
        geography: "County",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.367089280819286, 40.210804643387505],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Green Lane Borough",
        co_name: "Montgomery",
        state: "PA",
        PROJECTNAME:
          "Addressing Active Transportation and Trail-End Revitalization",
        projectnum: 0,
        projecttyp: null,
        ID: 709,
        status: null,
        AMOUNT: 36000,
        PROJ_DESC:
          "This plan will address safety and access deficiencies throughout the borough and provide recommendations to improve the quality of life for local residents and connect visitors along the trail network to the downtown.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$36,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.470691327243586, 40.336379599948955],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Whitemarsh Township",
        co_name: "Montgomery",
        state: "PA",
        PROJECTNAME:
          "Multi-Modal Connections between Washington Street and Spring Mill Station",
        projectnum: 0,
        projecttyp: null,
        ID: 710,
        status: null,
        AMOUNT: 80000,
        PROJ_DESC:
          "This study will assess a regionally important junction of pedestrian, bicycle, vehicle, and commuter-train transportation options at the junction of  the Spring Mill area which includes the Schuylkill River Trail (SRT),",
        proj_desc2:
          "SEPTA’s Manayunk/Norristown regional rail station, and the main roads of Hector, Lee and Washington streets.",
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$80,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.248201983918207, 40.104198020162954],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Philadelphia",
        co_name: "Philadelphia",
        state: "PA",
        PROJECTNAME: "North Philadelphia Transit First Corridor",
        projectnum: 0,
        projecttyp: null,
        ID: 711,
        status: null,
        AMOUNT: 90000,
        PROJ_DESC:
          "TCDI funds will be used to develop plans for Transit First and multimodal improvements on Olney Avenue, one of Philadelphia’s most important surface transit corridors.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$90,000",
        rptitle: null,
        report: null,
        mapped: "Yes",
        map_status: "Mapped as a study area",
        geography: "Study Area",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.134364938497299, 40.036936961159014],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Philadelphia",
        co_name: "Philadelphia",
        state: "PA",
        PROJECTNAME: "Philadelphia Complete Streets Delivery Program",
        projectnum: 0,
        projecttyp: null,
        ID: 712,
        status: null,
        AMOUNT: 85000,
        PROJ_DESC:
          "This program will provide clear  guidance, rules, standards, and best practices that are needed to effectively deliver the City’s vision of Complete or Great Streets.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$85,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the county level",
        geography: "County",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.134266262363056, 40.007624331663799],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Philadelphia",
        co_name: "Philadelphia",
        state: "PA",
        PROJECTNAME: "Philadelphia Trail and Sidepath Maintenance",
        projectnum: 0,
        projecttyp: null,
        ID: 713,
        status: null,
        AMOUNT: 60000,
        PROJ_DESC:
          "This plan is the next step in addressing a critical gap in advancing the City’s goal of creating a high-quality network of trails and sidepaths.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$60,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the county level",
        geography: "County",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.134266262363056, 40.007624331663799],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Philadelphia",
        co_name: "Philadelphia",
        state: "PA",
        PROJECTNAME: "25th Street Corridor Concepts",
        projectnum: 0,
        projecttyp: null,
        ID: 714,
        status: null,
        AMOUNT: 65000,
        PROJ_DESC:
          "The project will create conceptual traffic circulation designs along 25th Street,  examining both long-term and immediate improvements to advance safety goals and create better connections between the Grays Ferry and Point Breeze neighborhoods.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$65,000",
        rptitle: null,
        report: null,
        mapped: "Yes",
        map_status: "Mapped as a study area",
        geography: "Study Area",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.185994794110186, 39.935250636887879],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Philadelphia",
        co_name: "Philadelphia",
        state: "PA",
        PROJECTNAME: "Imagine Philadelphia Part 2",
        projectnum: 0,
        projecttyp: null,
        ID: 715,
        status: null,
        AMOUNT: 100000,
        PROJ_DESC:
          "Imagine Philadelphia Part 2 will examine current planning trends-safety, education, resilience, complete streets, vacancy reduction, and health (post COVID issues) to help inform the next comprehensive planning effort under the umbrella of a",
        proj_desc2: "changing landscape, influenced by rapid societal changes.",
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$100,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the county level",
        geography: "County",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.134266262363056, 40.007624331663799],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Bordentown City",
        co_name: "Burlington",
        state: "NJ",
        PROJECTNAME: "Developing Streetscape and Parking Enhancements",
        projectnum: 0,
        projecttyp: null,
        ID: 716,
        status: null,
        AMOUNT: 60000,
        PROJ_DESC:
          "TCDI funding will allow for an extensive streetscape and parking plan to be developed that addresses recent successes with downtown retail and restaurants.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$60,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-74.708691293368901, 40.149273660539727],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Pemberton Township",
        co_name: "Burlington",
        state: "NJ",
        PROJECTNAME: "CR 530-CR 687 Corridor Development",
        projectnum: 0,
        projecttyp: null,
        ID: 717,
        status: null,
        AMOUNT: 85000,
        PROJ_DESC:
          "This study will use impact assessments and other metrics to develop a land use sub-plan and land use ordinance text for adoption into the township’s master plan to ensure unified redevelopment and connectivity of this corridor.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$85,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-74.600801459526963, 39.956344751677655],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Haddonfield Borough",
        co_name: "Camden",
        state: "NJ",
        PROJECTNAME:
          "Mitigating Stormwater Impacts on the Transportation System",
        projectnum: 0,
        projecttyp: null,
        ID: 718,
        status: null,
        AMOUNT: 164000,
        PROJ_DESC:
          "The Boroughs of Audubon, Barrington, Haddonfield, and Haddon Heights will jointly address the lack of infrastructure and the increases in the frequency and volume of precipitation, which has created reoccurring flood issues in the roadways and caused",
        proj_desc2:
          "major disruption to the transportation network of the this part of Camden County.",
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$164,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.034530975124497, 39.895468939151918],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Woodbury City",
        co_name: "Gloucester",
        state: "NJ",
        PROJECTNAME: "Redbank Station Bike/Ped Shed Improvements",
        projectnum: 0,
        projecttyp: null,
        ID: 719,
        status: null,
        AMOUNT: 74000,
        PROJ_DESC:
          "Woodbury’s Opportunity Zone (OZ) Walk Shed study will develop recommended (bike/pedestrian) improvements, economic incentives, and zoning changes that will make the residential blocks surrounding the station more accessible, safe, and attractive",
        proj_desc2:
          "(economically and physically) for current and future Woodbury residents of all ages and abilities.",
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$74,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.153150978705796, 39.834086836421918],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Elk Township",
        co_name: "Gloucester",
        state: "NJ",
        PROJECTNAME: "Assessing Alternative Transportation",
        projectnum: 0,
        projecttyp: null,
        ID: 720,
        status: null,
        AMOUNT: 77000,
        PROJ_DESC:
          "This mult-municipal study will assess current and desired uses on existing infrastructure that could provide improvements to support cycling, walking, jogging, and running.  The study will explore ways the Township can encourage shared use paths.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$77,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-75.153175373551193, 39.665581198134014],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Trenton City",
        co_name: "Mercer",
        state: "NJ",
        PROJECTNAME: "TOD Strategic Plan",
        projectnum: 0,
        projecttyp: null,
        ID: 721,
        status: null,
        AMOUNT: 90000,
        PROJ_DESC:
          "The City of Trenton will update and consolidate a variety of TOD plans to ensure consistency in zoning between the land development ordinance and the redevelopment area plans. The new plan will align with the State’s redevelopment goals and priorities.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$90,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-74.764133736638911, 40.223679197846074],
      },
    },
    {
      type: "Feature",
      properties: {
        yr: 2021,
        MUNICIPALITY: "Hightstown Borough",
        co_name: "Mercer",
        state: "NJ",
        PROJECTNAME: "Redevelopment Area Circulation Concepts",
        projectnum: 0,
        projecttyp: null,
        ID: 722,
        status: null,
        AMOUNT: 50000,
        PROJ_DESC:
          "TCDI funds will be used to conduct a circulation study which will include a round-about feasibility and concept design element in order to identify circulation issues that will likely arise as a result of future planned redevelopment.",
        proj_desc2: null,
        proj_desc3: null,
        proj_desc4: null,
        amt_web: "$50,000",
        rptitle: null,
        report: null,
        mapped: "No",
        map_status: "Mapped at the municipal level",
        geography: "Municipal",
      },
      geometry: {
        type: "Point",
        coordinates: [-74.52528241722149, 40.268586733626258],
      },
    },
  ],
};

// Accordion functionality
const accordion = document.querySelectorAll(".accordion");
for (var i = 0; i < accordion.length; i++) {
  accordion[i].onclick = function () {
    // show/hide the accordions on click
    this.classList.toggle("active");

    // toggle the aria-expanded attribute of the accordion button
    let ariaExpandedBool = this.getAttribute("aria-expanded");
    ariaExpandedBool === "false"
      ? (ariaExpandedBool = "true")
      : (ariaExpandedBool = "false");
    this.setAttribute("aria-expanded", ariaExpandedBool);

    // toggle the aria-hidden attribute of the accordion panel
    const panel = this.nextElementSibling;
    let ariaHiddenBool = panel.getAttribute("aria-hidden");
    ariaHiddenBool === "false"
      ? (ariaHiddenBool = "true")
      : (ariaHiddenBool = "false");
    panel.setAttribute("aria-hidden", ariaHiddenBool);

    // show/hide the panel on click
    if (panel.style.maxHeight) {
      panel.style.maxHeight = null;
    } else {
      panel.style.maxHeight = panel.scrollHeight + "px";
    }
  };
}

const options = {
  method: "GET",
  mode: "cors",
  headers: {
    "Content-Type": "application/json; charset=utf-8",
  },
};

const getWebLinks = async (year) => {
  const stream = await fetch(
    `https://www.dvrpc.org/ASP/TCDIdirect/deliverableFileList_new.aspx?year=${year}`,
    options
  );

  let output = {};

  // check if the ID yields a response
  if (stream.ok) {
    const response = await stream.json();
    response.files.forEach((file) => {
      const id = file.properties.project;
      const link = file.webViewLink;

      // format response so that lookup time for the datasets loop is faster (only looping thru response once here, rather than for every dataset obj)
      output[id] = link;
    });
  } else {
    return null;
  }

  return output;
};

const makeTheRest = (props, table) => {
  const newRow = table.insertRow();
  const municipalityColumn = newRow.insertCell();
  const titleColumn = newRow.insertCell();
  const amountColumn = newRow.insertCell();

  const municipality = props["MUNICIPALITY"];
  const title = props["PROJECTNAME"];
  const amount = props["AMOUNT"].toLocaleString();

  municipalityColumn.textContent = municipality;

  amountColumn.textContent = "$" + amount;
  amountColumn.style.textAlign = "right";

  return [title, titleColumn];
};

const populateProjectDetails = function (dataset, tableName) {
  let isCurrent = false;

  // handle the currentDataSet being a geoJSON vs the rest being regular JSONs
  if (tableName === "currentDataSet") {
    dataset = dataset.features;
    isCurrent = dataset[0].properties.yr;
  }

  const table = document.querySelector("#" + tableName);
  const year = isCurrent || dataset[0]["YR"];

  // fill out the awards header
  const awardsHeader = document.querySelector("h2." + tableName);
  awardsHeader.textContent = year + " TCDI AWARDS";

  // fill out the accordion header & get links where applicable
  let response;
  if (tableName != "currentDataSet") {
    const accordionButton = document.querySelector("." + tableName);
    accordionButton.textContent = year + " Projects";
    response = getWebLinks(year);
  }

  // function to iterate over datasets so that the if(response) on line 130 can be DRY
  const populateListItems = function (response) {
    dataset.forEach(function (project) {
      let link;

      // grab the link from the response OR get the correct project format if iterating over the currentDataSet geoJSON (current data set will never have links b/c no deliverables yet)
      if (response) {
        const id = project["ID"];
        link = response[id] || null;
      } else {
        project = project.properties;
      }

      let [title, titleColumn] = [...makeTheRest(project, table)];

      // add links wherever they exist, otherwise just add text
      if (link) {
        titleColumn.innerHTML =
          "<a href=" + link + " rel='external'>" + title + "</a>";
      } else {
        titleColumn.textContent = title;
      }
    });
  };

  if (response) {
    response.then(function (responseProjects) {
      populateListItems(responseProjects);
    });
  } else {
    populateListItems(null);
  }
};

populateProjectDetails(currentDataSet, "currentDataSet");
populateProjectDetails(previousDataSet, "previousDataSet");
populateProjectDetails(secondPreviousDataSet, "secondPreviousDataSet");
// moved to archived projects 5/12/2022
// populateProjectDetails(thirdPreviousDataSet, "thirdPreviousDataSet");

mapboxgl.accessToken =
  "pk.eyJ1IjoibW1vbHRhIiwiYSI6ImNqZDBkMDZhYjJ6YzczNHJ4cno5eTcydnMifQ.RJNJ7s7hBfrJITOBZBdcOA";

const stylesheet = {
  version: 8,
  sources: {
    counties: {
      type: "vector",
      url: "https://tiles.dvrpc.org/data/dvrpc-municipal.json",
    },
  },
  layers: [
    {
      id: "county-fill",
      type: "fill",
      source: "counties",
      "source-layer": "county",
      layout: {},
      paint: {
        "fill-color": "#B6C1C6",
        "fill-opacity": 1,
      },
      filter: ["==", "dvrpc", "Yes"],
    },
    {
      id: "municipality-outline",
      type: "line",
      source: "counties",
      "source-layer": "municipalities",
      paint: {
        "line-width": 0.5,
        "line-color": "#efefef",
      },
    },
    {
      id: "county-outline",
      type: "line",
      source: "counties",
      "source-layer": "county",
      paint: {
        "line-width": 2.5,
        "line-color": "#fff",
      },
      filter: ["==", "dvrpc", "Yes"],
    },
  ],
};

const map = new mapboxgl.Map({
  container: "map",
  style: stylesheet,
  attributionControl: false,
  center: [-75.2273, 40.071],
  zoom: 8.82,
});

map.fitBounds([
  [-76.09405517578125, 39.49211914385648],
  [-74.32525634765625, 40.614734298694216],
]);

// define the max and min awards and radii for mapboxGl to consume
const awards = currentDataSet.features.map(function (project) {
  return project.properties.AMOUNT;
});

const maxAward = Math.max.apply(null, awards);
const minAward = Math.min.apply(null, awards);

const maxRadius = 25;
const minRadius = 5;

const award_layer = function (id) {
  return {
    id: id,
    type: "circle",
    source: id,
    paint: {
      "circle-radius": {
        property: "AMOUNT",
        type: "exponential",
        stops: [
          [minAward, minRadius],
          [maxAward, maxRadius],
        ],
      },
      "circle-color": "#6fb8b9",
      "circle-opacity": 0.7,
      "circle-stroke-width": 1.25,
      "circle-stroke-color": "#fff",
      "circle-stroke-opacity": 0.7,
    },
  };
};

const award_hover = function (id, source) {
  return {
    id: id,
    type: "circle",
    source: source,
    paint: {
      "circle-radius": {
        property: "AMOUNT",
        type: "exponential",
        stops: [
          [minAward, minRadius],
          [maxAward, maxRadius],
        ],
      },
      "circle-color": "#6fb8b9",
      "circle-opacity": 1,
      "circle-stroke-width": 1.5,
      "circle-stroke-color": "#fff",
      "circle-stroke-opacity": 1,
    },
    filter: ["==", "ID", ""],
  };
};

const popupDetails = function (e) {
  new mapboxgl.Popup({
    closebutton: true,
    closeOnClick: true,
  })
    .setLngLat(e.features[0].geometry.coordinates)
    .setHTML(
      "<strong>" +
        e.features[0].properties.PROJECTNAME +
        "</strong><hr class='popup-hr' />" +
        e.features[0].properties.PROJ_DESC +
        "..<br /><em>Award Amount: </em>$" +
        e.features[0].properties.AMOUNT.toLocaleString()
    )
    .addTo(map);
};

const legend = document.querySelector("#legend-labels");
const legendSizes = [
  { size: 25, class: "large" },
  { size: 15, class: "medium" },
  { size: 5, class: "small" },
];

const rateOfChange = (maxRadius - minRadius) / (maxAward - minAward);
const radiusAtZero = maxRadius - rateOfChange * maxAward;

const roundfive = function (num) {
  return num % 5 >= 2.5 ? parseInt(num / 5) * 5 + 5 : parseInt(num / 5) * 5;
};

const awardSize = function (circleRadius) {
  let awardVal = (circleRadius - radiusAtZero) / rateOfChange;
  let label = "$" + roundfive(awardVal).toLocaleString();
  return label;
};

legendSizes.forEach(function (circle) {
  let labelText = awardSize(circle.size);
  legend.insertAdjacentHTML(
    "beforeend",
    "<p class='leg-label'" + circle.class + ">" + labelText + "</p>"
  );
});

map.on("load", function () {
  map.addSource("current-year-awards", {
    type: "geojson",
    data: currentDataSet,
  });
  map.addLayer(award_layer("current-year-awards"));
  map.addLayer(award_hover("current-year-hover", "current-year-awards"));

  map.on("click", "current-year-awards", function (e) {
    popupDetails(e);
  });
  map.on("mousemove", "current-year-awards", function (e) {
    map.getCanvas().style.cursor = "pointer";
    map.setFilter("current-year-hover", [
      "==",
      "ID",
      e.features[0].properties["ID"],
    ]);
  });
  map.on("mouseleave", "current-year-awards", function (e) {
    map.getCanvas().style.cursor = "";
    map.setFilter("current-year-hover", ["==", "ID", ""]);
  });
});
