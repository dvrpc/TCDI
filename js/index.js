const thirdPreviousDataSet = [
  {
    YR: "2019",
    ID: "521",
    COUNTY: "Chester County ",
    MUNICIPALITY: "Chester County",
    AMOUNT: "125000",
    PROJECTNAME:
      "Active Transportation Municipal Ordinance Inventory and Outreach",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "524",
    COUNTY: "Burlington ",
    MUNICIPALITY: "Burlington City",
    AMOUNT: "50000",
    PROJECTNAME: "Downtown Circulation Plan",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "527",
    COUNTY: "Philadelphia",
    MUNICIPALITY: "City of Philadelphia (PCPC)",
    AMOUNT: "100000",
    PROJECTNAME: "Complete Streets",
    PM: "bmastaglio",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "528",
    COUNTY: "Philadelphia",
    MUNICIPALITY: "City of Philadelphia (oTis)",
    AMOUNT: "100000",
    PROJECTNAME: "Central Philadelphia Transportation Analysis Program",
    PM: "abernknopf",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "529",
    COUNTY: "Burlington",
    MUNICIPALITY: "Burlington County Bridge Commission",
    AMOUNT: "150000",
    PROJECTNAME: "County Route 541 Corridor Study",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "530",
    COUNTY: "Camden",
    MUNICIPALITY: "Gloucester City",
    AMOUNT: "65000",
    PROJECTNAME: "Port Neighborhood Transportation Study",
    PM: "mruane",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "531",
    COUNTY: "Camden ",
    MUNICIPALITY: "Collingswood Borough",
    AMOUNT: "72000",
    PROJECTNAME: "Bicycle and Pedestrian Enhancements Master Plan",
    PM: "tstead",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "532",
    COUNTY: "Montgomery",
    MUNICIPALITY: "Montgomery County",
    AMOUNT: "75000",
    PROJECTNAME:
      "Creating Equitable Connections to the Montgomery County Trail System",
    PM: "clinn",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "533",
    COUNTY: "Montgomery County",
    MUNICIPALITY: "Cheltenham Township",
    AMOUNT: "100000",
    PROJECTNAME: "Transportation Impact Study",
    PM: "asvekla",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "537",
    COUNTY: "Mercer County",
    MUNICIPALITY: "Lawrence Township",
    AMOUNT: "60000",
    PROJECTNAME: "Brunswick Pike Streetscape",
    PM: "laxelson",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "538",
    COUNTY: "Philadelphia",
    MUNICIPALITY: "City of Philadelphia (PCPC)",
    AMOUNT: "100000",
    PROJECTNAME: "North Philadelphia Station Area",
    PM: "kmorris",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "540",
    COUNTY: "Montgomery County, PA",
    MUNICIPALITY: "Pottstown Borough",
    AMOUNT: "32000",
    PROJECTNAME: "Keim Street Gateway Overlay Planning",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "541",
    COUNTY: "Bucks",
    MUNICIPALITY: "Middletown Township",
    AMOUNT: "67000",
    PROJECTNAME: "Comprehensive Plan Update",
    PM: "dlombardi",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "542",
    COUNTY: "Chester ",
    MUNICIPALITY: "New Garden Township",
    AMOUNT: "65000",
    PROJECTNAME:
      "Transportation Improvement Plan for the Village of Toughkenamon",
    PM: "abeatty",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "544",
    COUNTY: "Bucks ",
    MUNICIPALITY: "Chalfont Borough",
    AMOUNT: "50000",
    PROJECTNAME: "Parking Consolidation & Streetscape Plan",
    PM: "cboulan",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "545",
    COUNTY: "Montgomery ",
    MUNICIPALITY: "Upper Moreland Township",
    AMOUNT: "72000",
    PROJECTNAME: "Master Trail Plan",
    PM: "mandrews",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "547",
    COUNTY: "Pennsylvania",
    MUNICIPALITY: "City of Philadelphia (oTis)",
    AMOUNT: "100000",
    PROJECTNAME: "Vision Zero Pedestrian Safety Study & Action Plan",
    PM: "kmurphy",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "549",
    COUNTY: "Burlington County",
    MUNICIPALITY: "Burlington County",
    AMOUNT: "70000",
    PROJECTNAME: "Centerton Road Pedestrian-Bicycle Bridge Feasibility Study",
    PM: "slegendre",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "551",
    COUNTY: "Camden County",
    MUNICIPALITY: "Merchantville Borough",
    AMOUNT: "33000",
    PROJECTNAME: "Lighting Feasibility Study",
    PM: "ecompitello",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "552",
    COUNTY: "Delaware ",
    MUNICIPALITY: "Media Borough",
    AMOUNT: "90000",
    PROJECTNAME: "Traffic Calming Study",
    PM: "gkrykewycz",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "553",
    COUNTY: "Camden ",
    MUNICIPALITY: "Camden County",
    AMOUNT: "100000",
    PROJECTNAME: "Connecting Transportation and Land Use Along Haddon Avenue",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "556",
    COUNTY: "Montgomery County",
    MUNICIPALITY: "Lower Merion Township",
    AMOUNT: "52000",
    PROJECTNAME: "Multi-Modal Strategies and Policies",
    PM: "pelkis",
    FILENAME: "",
    GOOGLEID: "",
  },
  {
    YR: "2019",
    ID: "559",
    COUNTY: "Delaware County",
    MUNICIPALITY: "Concord Township",
    AMOUNT: "72000",
    PROJECTNAME: "1/202 Corridor Pedestrian Improvement Plan",
    PM: "kpcilurso",
    FILENAME: "",
    GOOGLEID: "",
  },
];

const secondPreviousDataSet = [
  {
    YR: 2021,
    ID: 606,
    MUNICIPALITY: "Bucks County",
    AMOUNT: 80000,
    PROJECTNAME: "Bucks County Pedestrian Safety Enhancements",
  },
  {
    YR: 2021,
    ID: 661,
    MUNICIPALITY: "Bucks County Planning Commission",
    AMOUNT: 60000,
    PROJECTNAME: "Upper Bucks County Area Public Transportation Analysis",
  },
  {
    YR: 2021,
    ID: 610,
    MUNICIPALITY: "Kennett Square Borough",
    AMOUNT: 80000,
    PROJECTNAME: "Kennett Region Micro-Transit Feasibility",
  },
  {
    YR: 2021,
    ID: 601,
    MUNICIPALITY: "Charlestown Township",
    AMOUNT: 64000,
    PROJECTNAME: "Devault Trail Activation Feasibility",
  },
  {
    YR: 2021,
    ID: 603,
    MUNICIPALITY: "Eddystone Borough",
    AMOUNT: 48000,
    PROJECTNAME: "Route 291 Corridor Improvements",
  },
  {
    YR: 2021,
    ID: 623,
    MUNICIPALITY: "Media Borough",
    AMOUNT: 64000,
    PROJECTNAME: "Hybrid Form-Based Code",
  },
  {
    YR: 2021,
    ID: 602,
    MUNICIPALITY: "Lansdowne Borough",
    AMOUNT: 85000,
    PROJECTNAME: "Eastern Delco Bikeway Prioritization",
  },
  {
    YR: 2021,
    ID: 605,
    MUNICIPALITY: "Upper Gwynedd Township",
    AMOUNT: 113000,
    PROJECTNAME: "Advancing the Liberty Bell Trail",
  },
  {
    YR: 2021,
    ID: 618,
    MUNICIPALITY: "Montgomery County",
    AMOUNT: 90000,
    PROJECTNAME: "Cross County Trail Feasibility",
  },
  {
    YR: 2021,
    ID: 608,
    MUNICIPALITY: "Green Lane Borough",
    AMOUNT: 36000,
    PROJECTNAME:
      "Addressing Active Transportation and Trail-End Revitalization",
  },
  {
    YR: 2021,
    ID: 616,
    MUNICIPALITY: "Whitemarsh Township",
    AMOUNT: 80000,
    PROJECTNAME:
      "Multi-Modal Connections between Washington Street and Spring Mill Station",
  },
  {
    YR: 2021,
    ID: 605,
    MUNICIPALITY: "Philadelphia",
    AMOUNT: 90000,
    PROJECTNAME: "North Philadelphia Transit First Corridor",
  },
  {
    YR: 2021,
    ID: 614,
    MUNICIPALITY: "Philadelphia",
    AMOUNT: 85000,
    PROJECTNAME: "Philadelphia Complete Streets Delivery Program",
  },
  {
    YR: 2021,
    ID: 617,
    MUNICIPALITY: "Philadelphia",
    AMOUNT: 60000,
    PROJECTNAME: "Philadelphia Trail and Sidepath Maintenance",
  },
  {
    YR: 2021,
    ID: 613,
    MUNICIPALITY: "Philadelphia",
    AMOUNT: 65000,
    PROJECTNAME: "25th Street Corridor Concepts",
  },
  {
    YR: 2021,
    ID: 607,
    MUNICIPALITY: "Philadelphia",
    AMOUNT: 100000,
    PROJECTNAME: "Imagine Philadelphia Part 2",
  },
  {
    YR: 2021,
    ID: 619,
    MUNICIPALITY: "Bordentown City",
    AMOUNT: 60000,
    PROJECTNAME: "Developing Streetscape and Parking Enhancements",
  },
  {
    YR: 2021,
    ID: 622,
    MUNICIPALITY: "Pemberton Township",
    AMOUNT: 85000,
    PROJECTNAME: "CR 530-CR 687 Corridor Development",
  },
  {
    YR: 2021,
    ID: 609,
    MUNICIPALITY: "Haddonfield Borough",
    AMOUNT: 164000,
    PROJECTNAME: "Mitigating Stormwater Impacts on the Transportation System",
  },
  {
    YR: 2021,
    ID: 612,
    MUNICIPALITY: "Woodbury City",
    AMOUNT: 74000,
    PROJECTNAME: "Redbank Station Bike/Ped Shed Improvements",
  },
  {
    YR: 2021,
    ID: 611,
    MUNICIPALITY: "Elk Township",
    AMOUNT: 77000,
    PROJECTNAME: "Assessing Alternative Transportation",
  },
  {
    YR: 2021,
    ID: 621,
    MUNICIPALITY: "Trenton City",
    AMOUNT: 90000,
    PROJECTNAME: "TOD Strategic Plan",
  },
  {
    YR: 2021,
    ID: 615,
    MUNICIPALITY: "Hightstown Borough",
    AMOUNT: 50000,
    PROJECTNAME: "Redevelopment Area Circulation Concepts",
  },
];

const previousDataSet = [
  {
    YR: 2023,
    MUNICIPALITY: "Chester County Planning Commission",
    PROJECTNAME: "Public Transportation Plan Update: Phase Two",
    ID: 683,
    AMOUNT: 60000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "City of Philadelphia",
    PROJECTNAME: "Complete Streets Delivery Program: Phase Two",
    ID: 692,
    AMOUNT: 100000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "City of Philadelphia",
    PROJECTNAME: "Preliminary Work for the Comprehensive Plan",
    ID: 690,
    AMOUNT: 100000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "City of Philadelphia",
    PROJECTNAME: "Neighborhood Bikeways",
    ID: 693,
    AMOUNT: 70000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "City of Philadelphia",
    PROJECTNAME: "Complete Streets Corridor Study for Aramingo Avenue",
    ID: 691,
    AMOUNT: 100000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "Township of Middletown",
    PROJECTNAME: "Multimodal Improvement Plan",
    ID: 681,
    AMOUNT: 85000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "Newtown Borough",
    PROJECTNAME: "Safety and Walkability Review for Multimodal Improvements",
    ID: 682,
    AMOUNT: 65000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "Borough of Oxford",
    PROJECTNAME: "SALDO and Zoning Update",
    ID: 684,
    AMOUNT: 100000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "Delaware County TMA",
    PROJECTNAME: "Chester Pike Corridor Multi Modal Improvement Study",
    ID: 686,
    AMOUNT: 125000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "Delaware County Planning Department",
    PROJECTNAME: "Route 291 Road Diet Study",
    ID: 685,
    AMOUNT: 150000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "Lower Salford Township",
    PROJECTNAME: "Feasibility Study for Walkable Lederach",
    ID: 689,
    AMOUNT: 100000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "Municipality of Norristown",
    PROJECTNAME: "Redevelopment Area Transportation Study",
    ID: 688,
    AMOUNT: 80000,
  },
  {
    YR: 2023,
    MUNICIPALITY: "Greater Valley Forge TMA",
    PROJECTNAME: "Community Mobility Hub Feasibility Study",
    ID: 687,
    AMOUNT: 65000,
  },
];

// mapped dataset has a much different shape from data displayed in accordions updating/archiving becomes a pain
const currentDataSet = {
  type: "FeatureCollection",
  features: [
    {
      geometry: {
        type: "Point",
        coordinates: [-74.73086389612111, 40.29627907352508],
      },
      type: "Feature",
      id: 10,
      properties: {
        yr: 2024,
        PROJECTNAME: "Johnson Trolley Trail Corridor Study",
        AMOUNT: 175000,
        MUNICIPALITY: "Mercer County",
        MCD: "Ewing Township, Lawrence Township, Princeton, Trenton City",
        ID: 350.0,
        PROJ_DESC:
          "The Johnson Trolley Trail is part of the Circuit Trails network, and this feasibility assessment will identify an alignment that connects, and extends, both existing and proposed segments. The outcome would be a bicycle and pedestrian corridor originating in the City of Trenton, passing through Ewing and Lawrence Townships, and terminating in the Municipality of Princeton.",
        geography: "Municipal",
      },
    },
    {
      geometry: {
        type: "Point",
        coordinates: [-74.79047417315965, 40.09393153142108],
      },
      type: "Feature",
      id: 10,
      properties: {
        yr: 2024,
        PROJECTNAME: "BurLink B5 Alternatives Analysis",
        AMOUNT: 100000,
        MUNICIPALITY: "Cross County Connection TMA",
        MCD: "Burlington Township & Florence Township",
        ID: 351.0,
        PROJ_DESC:
          "The BurLINK B5 shuttle operates in Florence and Burlington Townships, and serves as a first-mile/last-mile loop for commuters between NJ Transit\u2019s Florence River LINE Station and the Haines Industrial Park. Cross County Connection Transportation Management Association will conduct an analysis to identify limitations, inefficiencies, and quality of service issues; include a review of workforce automation trends in the sectors served by the shuttle to better understand how those trends may impact future ridership; and identify short-, medium-, and long-term improvement and funding options.",
        geography: "Municipal",
      },
    },
    {
      geometry: {
        type: "Point",
        coordinates: [-74.92232840965741, 40.065207435503304],
      },
      type: "Feature",
      id: 10,
      properties: {
        yr: 2024,
        PROJECTNAME: "Circulation Plan Element",
        AMOUNT: 75000,
        MUNICIPALITY: "Beverly City",
        ID: 352.0,
        PROJ_DESC:
          "TCDI funds will be used to develop a circulation plan element for the City\u2019s masterplan. The plan will be comprehensive, and provide recommendations for improving circulation of pedestrians, bicycles, and vehicles while addressing connections to public transit (e.g. NJ Transit\u2019s River LINE). Complete Streets and Green Streets principles will also be included.",
        geography: "Municipal",
      },
    },
    {
      geometry: {
        type: "Point",
        coordinates: [-74.87974188635692, 39.89800062914225],
      },
      type: "Feature",
      id: 10,
      properties: {
        yr: 2024,
        PROJECTNAME: "Southern Regional Trails Feasibility Study",
        AMOUNT: 100000,
        MUNICIPALITY: "Burlington County",
        MCD: "Evesham Township, Maple Shade Township, Medford Township, Moorestown Township, Mount Laurel Township",
        ID: 353.0,
        PROJ_DESC:
          "Burlington County will conduct a feasibility study to expand the Circuit Trail network from the Rancocas Creek Greenway Trail through multiple municipalities in Burlington County, including Maple Shade Township, Moorestown Township,Mount Laurel Township, Evesham Township, Medford Township, Shamong Township, and Tabernacle Township; as well as potential links to Camden County\u2019s regional trails.",
        geography: "Municipal",
      },
    },
    {
      geometry: {
        type: "Point",
        coordinates: [-75.05639683290443, 39.9649959907333],
      },
      type: "Feature",
      id: 10,
      properties: {
        yr: 2024,
        PROJECTNAME: "Pennsauken Transit Center TOD Study",
        AMOUNT: 100000,
        MUNICIPALITY: "NJ Transit",
        MCD: "Pennsauken Township",
        ID: 354.0,
        PROJ_DESC:
          "New Jersey Transit will use the TCDI funds to study the need for TOD at the Pennsauken Transit Center, which is an ADA-accessible intermodal transit facility with NJ Transit Atlantic City Rail, River LINE, and bus service, as well as identify transit-friendly improvements within the half-mile station area.",
        geography: "Municipal",
      },
    },
    {
      geometry: {
        type: "Point",
        coordinates: [-75.11815629485359, 39.8157059701066],
      },
      type: "Feature",
      id: 10,
      properties: {
        yr: 2024,
        PROJECTNAME: "Bicycle Facility Plan",
        AMOUNT: 50000,
        MUNICIPALITY: "Deptford Township",
        ID: 355.0,
        PROJ_DESC:
          "The Plan will provide a strategic approach to develop a network of improvements for bicyclists for commuting and recreational purposes in Deptford Township, where these types of facilities are currently lacking. The Plan will connect the retail nucleus centered on the Deptford Mall to neighborhoods and other trip generators, such as schools, the community college, other institutions and recreational areas.",
        geography: "Municipal",
      },
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-74.8325937004785, 40.16106520070865],
      },
      properties: {
        yr: 2024,
        PROJECTNAME: "D&L Trail Crossing Study",
        MUNICIPALITY: "Multi-municipal (Falls and Bristol Townships)",
        co_name: "Bucks",
        AMOUNT: 100000,
        longitude: -74.8325937005,
        id: 356,
        state: "PA",
        latitude: 40.1610652007,
        proj_desc2: "",
        PROJ_DESC:
          "TCDI funds will be used to study six specific road crossings along the D&L Trail within Falls and Bristol Townships. Current conditions at these locations create conflict between trail users and motorists. The Study will identify and develop safe crossing alternatives, wayfinding recommendations, and actionable steps for implementation.",
      },
      id: 0,
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.34756004655397, 40.4401232638427],
      },
      properties: {
        yr: 2024,
        PROJECTNAME: "Quakertown Borough Complete Streets Plan",
        MUNICIPALITY: "Quakertown",
        co_name: "Bucks",
        AMOUNT: 100000,
        longitude: -75.3475600466,
        id: 357,
        state: "PA",
        latitude: 40.4401232638,
        proj_desc2:
          "access for all users, including pedestrians, bicyclists, and motorists.",
        PROJ_DESC:
          "The Plan will identify and recommend elements of Complete Streets that are appropriate for specific corridors within Quakertown Borough that are known to be problematic and unsafe for pedestrians and cyclists. The goal is to improve safe access for all users, including pedestrians, bicyclists, and motorists.",
      },
      id: 1,
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.7987435979579, 39.98798155105647],
      },
      properties: {
        yr: 2024,
        PROJECTNAME: "Lincoln Highway Active Transportation Improvement Plan",
        MUNICIPALITY: "Multi-municipal (City of Coatesville and Caln Township)",
        co_name: "Chester",
        AMOUNT: 85000,
        longitude: -75.798743598,
        id: 358,
        state: "PA",
        latitude: 39.9879815511,
        proj_desc2: "",
        PROJ_DESC:
          "Route 30 (Lincoln Highway) is an important transportation corridor throughout Chester County, but also serves as a primary corridor within many of the County’s western communities. The funds will be used to develop a plan that will make Lincoln Highway a safer and more useable corridor for pedestrians, cyclists, and users of public transportation; and a corridor that better connects the communities that exist along it.",
      },
      id: 2,
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.70730063459794, 40.08251246432494],
      },
      properties: {
        yr: 2024,
        PROJECTNAME: "Eagle Village Gateways and Mobility Plan",
        MUNICIPALITY: "Upper Uwchlan Township",
        co_name: "Chester",
        AMOUNT: 100000,
        longitude: -75.7073006346,
        id: 359,
        state: "PA",
        latitude: 40.0825124643,
        proj_desc2: "",
        PROJ_DESC:
          "Eagle Village is the historic center for Upper Uwchlan Township. The Township will use these TCDI funds to build on prior efforts to improve walkability in the core by closing gaps in the multimodal network. The Plan will also identify appropriate traffic calming measures, and ways in which to enhance the sense of place within Eagle Village.",
      },
      id: 3,
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.26941977468525, 39.9195674166227],
      },
      properties: {
        yr: 2024,
        PROJECTNAME: "MacDade Boulevard Concept Development Study",
        MUNICIPALITY: "Multi-municipal (Collingdale and Darby Boroughs)",
        co_name: "Delaware",
        AMOUNT: 175000,
        longitude: -75.2694197747,
        id: 360,
        state: "PA",
        latitude: 39.9195674166,
        proj_desc2: "",
        PROJ_DESC:
          "Collingdale and Darby Boroughs will use TCDI funds to identify appropriate strategies for improving pedestrian and cyclist safety, and increasing multimodal options along MacDade Boulevard. Strategies may include, but are not limited to, road diets and protected bike lines.",
      },
      id: 4,
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.36814418979104, 40.03200051269969],
      },
      properties: {
        yr: 2024,
        PROJECTNAME: "Downtown Wayne Master Plan",
        MUNICIPALITY: "Radnor Township",
        co_name: "Delaware",
        AMOUNT: 100000,
        longitude: -75.3681441898,
        id: 361,
        state: "PA",
        latitude: 40.0320005127,
        proj_desc2: "",
        PROJ_DESC:
          "The Plan will identify multimodal improvements, economic development strategies, and other infrastructure improvements for the Township’s social and economic center, Wayne. The goal is to coordinate the area’s redevelopment, as well as increease safety for cyclists and pedestrians.",
      },
      id: 5,
    },

    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.18019879717662, 40.09896040867198],
      },
      properties: {
        yr: 2024,
        PROJECTNAME: "Cheltenham Avenue Road Diet Feasibility Study",
        MUNICIPALITY: "Multi-municipal  (Cheltenham and Springfield Townships)",
        co_name: "Montgomery",
        AMOUNT: 135000,
        longitude: -75.1801987972,
        id: 362,
        state: "PA",
        latitude: 40.0989604087,
        proj_desc2: "",
        PROJ_DESC:
          "Montgomery County, with direct involvement from Cheltenham and Springfield Townships, will develop a road diet feasibility study aimed at improving accommodations for pedestrians and cyclists, and safety for all roadway users; and reducing vehicle speeds along Cheltenham Avenue.",
      },
      id: 6,
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.11471784013146, 40.11384950254374],
      },
      properties: {
        yr: 2024,
        PROJECTNAME: "Abington Separated Bike Lanes Action Plan",
        MUNICIPALITY: "Abington Township",
        co_name: "Montgomery",
        AMOUNT: 75000,
        longitude: -75.1147178401,
        id: 363,
        state: "PA",
        latitude: 40.1138495025,
        proj_desc2: "",
        PROJ_DESC:
          "The funds will be used to develop an action plan that will identify and prioritize corridors for separated bike lanes throughout the Township. This will build on prior Township efforts that focused primarily on a network of sharrows and unprotected bike lanes, and better connect the existing bicycle network with the Township’s seven SEPTA stations.",
      },
      id: 7,
    },
    {
      type: "Feature",
      geometry: { type: "Point", coordinates: [-75.09952698, 39.98078434] },
      properties: {
        yr: 2024,
        PROJECTNAME:
          "Philadelphia Complete Streets Area Study: Port Richmond Industrial District and Waterfront",
        MUNICIPALITY: "City of Philadelphia",
        co_name: "Philadelphia",
        AMOUNT: 60000,
        longitude: -75.09952698,
        id: 364,
        state: "PA",
        latitude: 39.98078434,
        proj_desc2: "",
        PROJ_DESC:
          "TCDI funds will be used to develop a conceptual plan for the Port Richmond neighborhood that will incorporate Complete Streets, address accessibility of the Delaware River Trail, and provide site recommendations and best practices for truck routing and overnight parking to reduce impacts on residents.",
      },
      id: 8,
    },
    {
      type: "Feature",
      geometry: { type: "Point", coordinates: [-75.19821305, 39.939724] },
      properties: {
        yr: 2024,
        PROJECTNAME: "34th Street at Grays Ferry Visioning Project",
        MUNICIPALITY: "City of Philadelphia",
        co_name: "Philadelphia",
        AMOUNT: 90000,
        longitude: -75.19821305,
        id: 365,
        state: "PA",
        latitude: 39.939724,
        proj_desc2: "",
        PROJ_DESC:
          "The project will focus on the redesign of two intersections in Grays Ferry, and the stretch of 34th Street that connects them. The goal is to improve safety for pedestrians and cyclists, as well as accommodate truck traffic, while balancing the needs of residents and businesses in the surrounding neighborhood.",
      },
      id: 9,
    },
    {
      type: "Feature",
      geometry: { type: "Point", coordinates: [-75.18308865, 39.95479896] },
      properties: {
        yr: 2024,
        PROJECTNAME: "Intercity Bus Terminal Site Planning Project",
        MUNICIPALITY: "City of Philadelphia",
        co_name: "Philadelphia",
        AMOUNT: 90000,
        longitude: -75.18308865,
        id: 366,
        state: "PA",
        latitude: 39.95479896,
        proj_desc2: "",
        PROJ_DESC:
          "The project will greatly emphasize stakeholder outreach and engagement to evaluate three preidentified potential locations for the intercity bus terminal within the 30th Street Station area. Through a feasibility analysis, a preferred site will be identified, and preliminary designs developed.",
      },
      id: 10,
    },
    {
      type: "Feature",
      geometry: { type: "Point", coordinates: [-75.21085197, 39.94200379] },
      properties: {
        yr: 2024,
        PROJECTNAME:
          "48th & Woodland Playground Area Transportation Safety Study",
        MUNICIPALITY: "City of Philadelphia",
        co_name: "Philadelphia",
        AMOUNT: 90000,
        longitude: -75.21085197,
        id: 367,
        state: "PA",
        latitude: 39.94200379,
        proj_desc2: "",
        PROJ_DESC:
          "The confluence of various transit modes and a complicated street network in this area create challenges for multimodal options, concerns regarding pedestrian and cyclist safety, and serve as barriers to access. The effort will provide a plan for short, medium, and long-term implementation of strategies that will improve the quality of life of residents in the surrounding neighborhood, and increase safety among multimodal options.",
      },
      id: 11,
    },
  ],
};

// Accordion functionality
const accordion = document.querySelectorAll(".accordion");
for (var i = 0; i < accordion.length; i++) {
  accordion[i].onclick = function () {
    // show/hide the accordions on click
    this.classList.toggle("active");

    // toggle the aria-expanded attribute of the accordion button
    let ariaExpandedBool = this.getAttribute("aria-expanded");
    ariaExpandedBool === "false"
      ? (ariaExpandedBool = "true")
      : (ariaExpandedBool = "false");
    this.setAttribute("aria-expanded", ariaExpandedBool);

    // toggle the aria-hidden attribute of the accordion panel
    const panel = this.nextElementSibling;
    let ariaHiddenBool = panel.getAttribute("aria-hidden");
    ariaHiddenBool === "false"
      ? (ariaHiddenBool = "true")
      : (ariaHiddenBool = "false");
    panel.setAttribute("aria-hidden", ariaHiddenBool);

    // show/hide the panel on click
    if (panel.style.maxHeight) {
      panel.style.maxHeight = null;
    } else {
      panel.style.maxHeight = panel.scrollHeight + "px";
    }
  };
}

const getWebLinks = async (year) => {
  const stream = await fetch(
    `https://www.dvrpc.org/asp/tcdidirect/deliverableFileList_new.aspx?year=${year}`,
  );

  let output = {};

  // check if the ID yields a response
  if (stream.ok) {
    const response = await stream.json();
    response.files.forEach((file) => {
      const id = file.properties.project;
      const link = file.webViewLink;

      // format response so that lookup time for the datasets loop is faster (only looping thru response once here, rather than for every dataset obj)
      output[id] = link;
    });
  } else {
    return null;
  }

  return output;
};

const makeTheRest = (props, table) => {
  const newRow = table.insertRow();
  const municipalityColumn = newRow.insertCell();
  const titleColumn = newRow.insertCell();
  const amountColumn = newRow.insertCell();

  const municipality = props["MUNICIPALITY"];
  const title = props["PROJECTNAME"];
  const amount = props["AMOUNT"].toLocaleString();

  municipalityColumn.textContent = municipality;

  amountColumn.textContent = "$" + amount;
  amountColumn.style.textAlign = "right";

  return [title, titleColumn];
};

const populateProjectDetails = function (dataset, tableName) {
  let isCurrent = false;

  // handle the currentDataSet being a geoJSON vs the rest being regular JSONs
  if (tableName === "currentDataSet") {
    dataset = dataset.features;
    isCurrent = dataset[0].properties.yr;
  }

  const table = document.querySelector("#" + tableName);
  const year = isCurrent || dataset[0]["YR"];
  const yearShort = year - 2000;

  // fill out the awards header
  const awardsHeader = document.querySelector("h2." + tableName);
  awardsHeader.textContent = isCurrent
    ? "FY24 NJ & FY25 PA TCDI Awards"
    : "FY" + year + " TCDI Awards";

  // fill out the accordion header & get links where applicable
  let response;
  if (tableName != "currentDataSet") {
    const accordionButton = document.querySelector("." + tableName);
    accordionButton.textContent = "FY " + year;
    response = getWebLinks(year);
  }

  // function to iterate over datasets so that the if(response) on line 130 can be DRY
  const populateListItems = function (response) {
    dataset.forEach(function (project) {
      let link;

      // grab the link from the response OR get the correct project format if iterating over the currentDataSet geoJSON (current data set will never have links b/c no deliverables yet)
      if (response) {
        const id = project["ID"];
        link = response[id] || null;
      } else {
        project = project.properties;
      }

      let [title, titleColumn] = [...makeTheRest(project, table)];

      // add links wherever they exist, otherwise just add text
      if (link) {
        titleColumn.innerHTML =
          "<a href=" + link + " rel='external'>" + title + "</a>";
      } else {
        titleColumn.textContent = title;
      }
    });
  };

  if (response) {
    response.then(function (responseProjects) {
      populateListItems(responseProjects);
    });
  } else {
    populateListItems(null);
  }
};

populateProjectDetails(currentDataSet, "currentDataSet");
populateProjectDetails(previousDataSet, "previousDataSet");
populateProjectDetails(secondPreviousDataSet, "secondPreviousDataSet");
// moved to archived projects 5/12/2022
populateProjectDetails(thirdPreviousDataSet, "thirdPreviousDataSet");

mapboxgl.accessToken =
  "pk.eyJ1IjoiY3J2YW5wb2xsYXJkIiwiYSI6ImNseHVpZmprazI4bWoycXB2MTljMWF1YjUifQ.jLMaSXqIUV5N2IxYlk5ZiQ";

const stylesheet = {
  version: 8,
  sources: {
    counties: {
      type: "vector",
      url: "https://tiles.dvrpc.org/data/dvrpc-municipal.json",
    },
  },
  layers: [
    {
      id: "county-fill",
      type: "fill",
      source: "counties",
      "source-layer": "county",
      layout: {},
      paint: {
        "fill-color": "#B6C1C6",
        "fill-opacity": 1,
      },
      filter: ["==", "dvrpc", "Yes"],
    },
    {
      id: "municipality-outline",
      type: "line",
      source: "counties",
      "source-layer": "municipalities",
      paint: {
        "line-width": 0.5,
        "line-color": "#efefef",
      },
    },
    {
      id: "county-outline",
      type: "line",
      source: "counties",
      "source-layer": "county",
      paint: {
        "line-width": 2.5,
        "line-color": "#fff",
      },
      filter: ["==", "dvrpc", "Yes"],
    },
  ],
};

const map = new mapboxgl.Map({
  container: "map",
  style: stylesheet,
  attributionControl: false,
  center: [-75.2273, 40.071],
  minZoom: 7.75,
  maxZoom: 12,
  zoom: 8.82,
});

map.fitBounds([
  [-76.09405517578125, 39.49211914385648],
  [-74.32525634765625, 40.614734298694216],
]);

// define the max and min awards and radii for mapboxGl to consume
const awards = currentDataSet.features.map(function (project) {
  return project.properties.AMOUNT;
});

const maxAward = Math.max.apply(null, awards);
const minAward = Math.min.apply(null, awards);

const maxRadius = 25;
const minRadius = 5;

const award_layer = function (id) {
  return {
    id: id,
    type: "circle",
    source: id,
    paint: {
      "circle-radius": {
        property: "AMOUNT",
        type: "exponential",
        stops: [
          [minAward, minRadius],
          [maxAward, maxRadius],
        ],
      },
      "circle-color": "#6fb8b9",
      "circle-opacity": 0.7,
      "circle-stroke-width": 1.25,
      "circle-stroke-color": "#fff",
      "circle-stroke-opacity": 0.7,
    },
  };
};

const award_hover = function (id, source) {
  return {
    id: id,
    type: "circle",
    source: source,
    paint: {
      "circle-radius": {
        property: "AMOUNT",
        type: "exponential",
        stops: [
          [minAward, minRadius],
          [maxAward, maxRadius],
        ],
      },
      "circle-color": "#6fb8b9",
      "circle-opacity": 1,
      "circle-stroke-width": 1.5,
      "circle-stroke-color": "#fff",
      "circle-stroke-opacity": 1,
    },
    filter: ["==", "ID", ""],
  };
};

const popupDetails = function (e) {
  new mapboxgl.Popup({
    closebutton: true,
    closeOnClick: true,
  })
    .setLngLat(e.features[0].geometry.coordinates)
    .setHTML(
      "<strong>" +
        e.features[0].properties.PROJECTNAME +
        "</strong>" +
        "<br /><em>Award Amount: </em>$" +
        e.features[0].properties.AMOUNT.toLocaleString() +
        "<hr class='popup-hr' />" +
        e.features[0].properties.PROJ_DESC,
    )
    .addTo(map);
};

const legend = document.querySelector("#legend-labels");
const legendSizes = [
  { size: 25, class: "large" },
  { size: 15, class: "medium" },
  { size: 5, class: "small" },
];

const rateOfChange = (maxRadius - minRadius) / (maxAward - minAward);
const radiusAtZero = maxRadius - rateOfChange * maxAward;

const roundfive = function (num) {
  return num % 5 >= 2.5 ? parseInt(num / 5) * 5 + 5 : parseInt(num / 5) * 5;
};

const awardSize = function (circleRadius) {
  let awardVal = (circleRadius - radiusAtZero) / rateOfChange;
  let label = "$" + roundfive(awardVal).toLocaleString();
  return label;
};

legendSizes.forEach(function (circle) {
  let labelText = awardSize(circle.size);
  legend.insertAdjacentHTML(
    "beforeend",
    "<p class='leg-label'" + circle.class + ">" + labelText + "</p>",
  );
});

map.on("load", function () {
  map.addSource("current-year-awards", {
    type: "geojson",
    data: currentDataSet,
  });
  map.addLayer(award_layer("current-year-awards"));
  map.addLayer(award_hover("current-year-hover", "current-year-awards"));

  map.on("click", "current-year-awards", function (e) {
    popupDetails(e);
  });
  map.on("mousemove", "current-year-awards", function (e) {
    map.getCanvas().style.cursor = "pointer";
    map.setFilter("current-year-hover", [
      "==",
      "ID",
      e.features[0].properties["ID"],
    ]);
  });
  map.on("mouseleave", "current-year-awards", function (e) {
    map.getCanvas().style.cursor = "";
    map.setFilter("current-year-hover", ["==", "ID", ""]);
  });
});
